{"version":3,"sources":["assets\\Script\\GameLayer.js"],"names":["spriteCreator","require","ConfirmDialogPrefab","StorageManager","self","cc","Class","Component","properties","landRange","v2","landWidth","hero","Node","firstLand","secondLand","canvas","moveDuration","stickSpeed","heroMoveSpeed","stickWidth","isTouchStart","score","Label","highScore","perfectTips","onLoad","log","runLength","currentLandRange","heroWorldPosX","heroMoveX","scoreNum","winSize","director","getWinSize","highScoreNum","getHighestScore","string","exitDialog","registerEvent","createNewLand","curRange","getLandRange","setPosition","width","anchorX","x","stick","createStick","start","on","EventType","TOUCH_START","touchStart","bind","node","TOUCH_END","touchEnd","TOUCH_CANCEL","touchCancel","systemEvent","SystemEvent","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","console","unregisterEvent","targetOff","off","event","StickFall","keyCode","KEY","backspace","callFuncYes","end","callFuncNo","showDialog","getLandWidth","parent","Math","random","y","update","dt","height","HeroMoved","time","heroMove","moveBy","p","callFunc","isSuccess","se","sequence","runAction","stickFall","rotateBy","easing","easeIn","stickHeight","minLength","maxLength","middleLength","active","seq","delayTime","Next","GameOver","length","action","range","l","secondAction","setHighestScore","reStarGame","loadScene","exitGame","title","content","btn1Str","btn1Cb","btn2Str","btn2Cb","loader","loadRes","err","prefab","newNode","instantiate","getScene","addChild","getComponent","show"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\nvar spriteCreator = require(\"spriteCreator\");\r\nvar ConfirmDialogPrefab = require(\"CommonDialg\");\r\nvar StorageManager = require(\"storageManager\");\r\n\r\n\r\nvar self = null;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        landRange:cc.v2(20,300),\r\n        landWidth:cc.v2(20,200),\r\n        hero:cc.Node,\r\n        firstLand:cc.Node,\r\n        secondLand:cc.Node,\r\n        canvas:cc.Node,  \r\n        moveDuration:0.5,\r\n        stickSpeed:400,\r\n        heroMoveSpeed:400,\r\n        stickWidth:6,\r\n        isTouchStart:false,\r\n        score:cc.Label,\r\n        highScore:cc.Label,\r\n        perfectTips:cc.Label,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        cc.log(\"onLoad ()\");\r\n\r\n        self = this;\r\n        this.runLength = 0;\r\n        this.currentLandRange = 0;\r\n        this.heroWorldPosX = 0;\r\n        this.heroMoveX = 0; \r\n        this.scoreNum = 0;\r\n        this.winSize = cc.director.getWinSize();\r\n\r\n\r\n        this.highScoreNum = StorageManager.getHighestScore();\r\n        this.highScore.string = \"最高得分:\"+this.highScoreNum;\r\n        this.exitDialog = false;\r\n\r\n        // this.perfectTips.node.active = true;\r\n\r\n        //注册触摸监听事件\r\n        this.registerEvent();\r\n        //创建一个新的陆地\r\n        this.createNewLand();\r\n        var curRange = this.getLandRange();\r\n        this.secondLand.setPosition(curRange,0);\r\n\r\n        //角色位置\r\n        this.heroWorldPosX = this.firstLand.width - (1-this.hero.anchorX) * this.hero.width - this.stickWidth;\r\n        this.hero.x = this.heroWorldPosX\r\n\r\n        //棍子位置\r\n        this.stick = this.createStick();\r\n        this.stick.x = this.hero.x + this.hero.width * (1-this.hero.anchorX) + this.stick.width * this.stick.anchorX;\r\n    },\r\n\r\n    start () {\r\n        cc.log(\"start ()\");\r\n    },\r\n    registerEvent(){\r\n        //触摸事件\r\n        this.canvas.on(cc.Node.EventType.TOUCH_START, this.touchStart.bind(this), this.node);\r\n        this.canvas.on(cc.Node.EventType.TOUCH_END,this.touchEnd.bind(this), this.node);\r\n        this.canvas.on(cc.Node.EventType.TOUCH_CANCEL,this.touchCancel.bind(this), this.node);\r\n\r\n        //键盘事件\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n        console.log(\"on\");\r\n    },\r\n    unregisterEvent(){\r\n        this.canvas.targetOff(this.node);\r\n\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n        console.log(\"off\");\r\n    },\r\n    touchStart(event){\r\n        // fsm.stickLengthen();\r\n        cc.log(\"touchStart\");\r\n        this.isTouchStart = true; \r\n        return false;\r\n    },\r\n    touchEnd(event){\r\n        // fsm.heroTick();\r\n        cc.log(\"touchEnd\");\r\n        this.isTouchStart = false;\r\n        this.StickFall();\r\n    },\r\n    touchCancel(){\r\n        // this.touchEnd();\r\n        cc.log(\"touchCancel\");\r\n        this.isTouchStart = false\r\n    },\r\n    onKeyDown(){\r\n        cc.log(\"keyDown:\"+event.keyCode);\r\n        switch(event.keyCode) {\r\n            case cc.KEY.backspace:\r\n                var callFuncYes = function(){\r\n                    cc.director.end();\r\n                };\r\n                var callFuncNo = function(){\r\n                    // cc.director.loadScene('gameScene');\r\n                    self.exitDialog = false;\r\n                };\r\n                if(!self.exitDialog){\r\n                    self.exitDialog = true;\r\n                    self.showDialog(\"通知\",\"是否退出游戏!\",\"是\",callFuncYes,\"\",callFuncNo);\r\n                }\r\n                break;\r\n        }\r\n    },\r\n    onKeyUp(){\r\n        cc.log(\"keyUp\");\r\n        switch(event.keyCode) {\r\n            case cc.KEY.backspace:\r\n                break;\r\n        }\r\n    },\r\n    createNewLand() {\r\n        cc.log(\">>>createNewLand\")\r\n        this.secondLand = spriteCreator.createNewLand(this.getLandWidth());\r\n        this.secondLand.parent = this.node;\r\n    },\r\n    getLandRange(){\r\n        var winSize = cc.director.getWinSize();\r\n        this.currentLandRange = 50+(winSize.width - this.secondLand.width)*Math.random();\r\n        if(winSize.width < this.currentLandRange + this.secondLand.width){\r\n            this.currentLandRange = winSize.width - this.secondLand.width - 50;\r\n        }\r\n        return this.currentLandRange;\r\n    },\r\n    getLandWidth(){\r\n        var landWidth = this.landWidth.x + (this.landWidth.y - this.landWidth.x)* Math.random();\r\n        if(landWidth<30){\r\n            landWidth = 30;\r\n        }\r\n        return landWidth;\r\n    },\r\n    createStick(){\r\n        cc.log(\"createStick\");\r\n        var stick = spriteCreator.createStick(this.stickWidth);\r\n        stick.parent = this.node;\r\n        return stick;\r\n    },\r\n    update (dt) {\r\n        if(this.isTouchStart)\r\n        {\r\n            // cc.log(\">>>>>>>> dt\");\r\n            this.stick.height += dt*this.stickSpeed;\r\n        }\r\n    },\r\n    //英雄移动\r\n    HeroMoved(){\r\n        cc.log(\">>>>HeroMoved\")\r\n\r\n        this.heroMoveX = this.stick.height\r\n        var time = this.heroMoveX/this.heroMoveSpeed;\r\n        var heroMove = cc.moveBy(time,cc.p(this.heroMoveX,0));\r\n\r\n        var callFunc = cc.callFunc(function(){\r\n            cc.log(\"成功失败判定\");\r\n            self.isSuccess();\r\n        });\r\n        var se =cc.sequence(heroMove,callFunc);\r\n        this.hero.runAction(se);\r\n    },\r\n    //棍子掉落\r\n    StickFall(){\r\n        this.unregisterEvent();\r\n        var stickFall = cc.rotateBy(0.5, 90);\r\n        stickFall.easing(cc.easeIn(3));\r\n        var callFunc = cc.callFunc(function(){\r\n            cc.log(\"hero move\");\r\n            self.HeroMoved();\r\n        });\r\n        var se =cc.sequence(stickFall,callFunc);\r\n        this.stick.runAction(se);\r\n\r\n        this.stickHeight = this.stick.height;\r\n    },\r\n    //成功失败判定\r\n    isSuccess(){\r\n        var minLength = this.secondLand.x - this.firstLand.x - this.firstLand.width+2;\r\n        var maxLength = this.secondLand.x - this.firstLand.x + this.secondLand.width - this.firstLand.width+5;\r\n\r\n        cc.log(\">>>minLength:\"+minLength+\">>>maxLength:\"+maxLength+\" height:\"+this.stickHeight);\r\n\r\n        if(this.stickHeight > minLength && this.stickHeight < maxLength)\r\n        {\r\n            cc.log(\">>>Success\")\r\n            //完美距离判定\r\n            var middleLength = maxLength - this.secondLand.width/2;\r\n            if(this.stickHeight > (middleLength - 6) && this.stickHeight < (middleLength + 3)){\r\n                this.scoreNum = this.scoreNum + 2;\r\n                this.score.string = \"得分:\"+this.scoreNum;\r\n\r\n                this.perfectTips.node.active = true;\r\n                var callFunc = cc.callFunc(function(){\r\n                    self.perfectTips.node.active = false;\r\n                });\r\n                var seq =cc.sequence(cc.delayTime(1.0),callFunc);\r\n                this.perfectTips.node.runAction(seq);\r\n            }else{\r\n                this.scoreNum = this.scoreNum + 1;\r\n                this.score.string = \"得分:\"+this.scoreNum;\r\n            }\r\n\r\n            this.Next();\r\n        }else{\r\n            cc.log(\">>>failed\")\r\n            this.GameOver();\r\n        }\r\n    },\r\n    Next(){\r\n        var winSize = cc.director.getWinSize();\r\n        cc.log(\"currentLandRange:\"+this.currentLandRange)\r\n        var length = this.currentLandRange + this.secondLand.width - 30;\r\n        this.runLength +=length;\r\n        var action = cc.moveBy(this.moveDuration,cc.p(-length,0));\r\n        this.node.runAction(action);\r\n\r\n        this.firstLand = this.secondLand;\r\n\r\n        this.createNewLand();\r\n\r\n        this.stick.height = 0;\r\n        var stickFall = cc.rotateBy(0.1, -90);\r\n        this.stick.runAction(stickFall);\r\n\r\n        //landRange\r\n        var range = this.getLandRange();\r\n\r\n        var callFunc = cc.callFunc(function(){\r\n            self.hero.x = self.runLength+10;\r\n            self.stick.x = self.hero.x + self.hero.width * (1-self.hero.anchorX) + self.stick.width * self.stick.anchorX;\r\n            self.registerEvent();\r\n        });\r\n\r\n        //secondland;\r\n        this.secondLand.setPosition(this.runLength+winSize.width,0);\r\n        var l = winSize.width - range;\r\n        var secondAction = cc.moveBy(this.moveDuration,cc.p(-l,0));\r\n        var seq =cc.sequence(secondAction,callFunc);\r\n        this.secondLand.runAction(seq);\r\n    },\r\n    GameOver(){\r\n\r\n        if(this.highScoreNum < this.scoreNum){\r\n            this.highScoreNum = this.scoreNum;\r\n            StorageManager.setHighestScore(this.highScoreNum);\r\n            this.highScore.string = \"最高得分:\"+this.highScoreNum;\r\n        }\r\n\r\n        var stickFall = cc.rotateBy(0.5, 90);\r\n        stickFall.easing(cc.easeIn(3));\r\n        this.stick.runAction(stickFall);\r\n        var action = cc.moveBy(0.5,cc.p(0,-350));\r\n        action.easing(cc.easeIn(3));\r\n        this.hero.runAction(action);\r\n\r\n        var reStarGame = function(){\r\n            cc.director.loadScene('gameScene');\r\n        };\r\n        var exitGame = function(){\r\n                    cc.director.end();\r\n                };\r\n        this.showDialog(\"通知\",\"游戏失败!\",\"再来一次\",reStarGame,\"\",exitGame);\r\n    },\r\n    // 弹出一个确认框\r\n    showDialog(title, content, btn1Str, btn1Cb, btn2Str, btn2Cb){\r\n        cc.log(\"showDialog \");\r\n        // 加载 Prefab\r\n        cc.loader.loadRes(\"CommonDialg\", function (err, prefab) {\r\n            if (err) {\r\n                cc.log(err);\r\n                return;\r\n            }\r\n            var newNode = cc.instantiate(prefab);\r\n            cc.director.getScene().addChild(newNode);\r\n            newNode.getComponent(ConfirmDialogPrefab).show(title, content, btn1Str, btn1Cb, btn2Str, btn2Cb);\r\n        });\r\n    },\r\n});\r\n\r\n\r\n\r\n\r\n"]}